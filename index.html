<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>í•œêµ­ìˆ˜ì•ˆ AI ì…ì°°ê´€ë¦¬</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
    }
    a { color: #38bdf8; text-decoration: none; }

    /* ìƒë‹¨ ë°” */
    header {
      background: #020617;
      border-bottom: 1px solid #1f2937;
      padding: 10px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    header .title {
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    header .title span.badge {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      background: #1d4ed8;
      color: #e5e7eb;
    }
    header button {
      background: #111827;
      border: 1px solid #374151;
      color: #e5e7eb;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      cursor: pointer;
    }
    header button:hover {
      background: #1f2937;
    }

    /* í•„í„° ì˜ì—­ */
    .filter-wrapper {
      padding: 10px 16px;
      background: #020617;
      border-bottom: 1px solid #1f2937;
      transition: max-height 0.25s ease, opacity 0.25s ease;
      overflow: hidden;
    }
    .filter-wrapper.collapsed {
      max-height: 0;
      opacity: 0;
      padding-top: 0;
      padding-bottom: 0;
      border-bottom: none;
    }
    .filter-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .filter-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
      min-width: 160px;
      flex: 1;
    }
    .filter-item label {
      font-size: 11px;
      color: #9ca3af;
    }
    .filter-item input, .filter-item select {
      background: #020617;
      border: 1px solid #374151;
      border-radius: 6px;
      padding: 6px 8px;
      color: #e5e7eb;
      font-size: 13px;
    }

    /* ë³¸ë¬¸ */
    main {
      padding: 12px 16px 24px;
    }

    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      gap: 8px;
      flex-wrap: wrap;
    }
    .toolbar .left {
      display: flex;
      gap: 8px;
      align-items: center;
      font-size: 13px;
      color: #9ca3af;
    }
    .toolbar .right {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .btn {
      background: #111827;
      border-radius: 999px;
      border: 1px solid #374151;
      font-size: 12px;
      color: #e5e7eb;
      padding: 4px 10px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .btn.primary {
      background: #1d4ed8;
      border-color: #1d4ed8;
    }
    .btn.primary:hover {
      background: #2563eb;
    }
    .btn:hover {
      background: #1f2937;
    }

    .status-pill {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      background: #0f172a;
      border: 1px solid #1f2937;
      color: #9ca3af;
    }

    /* ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ */
    .bid-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .bid-card {
      background: #020617;
      border-radius: 12px;
      border: 1px solid #1f2937;
      padding: 10px 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .bid-main {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .bid-title-line {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
    }
    .bid-region {
      font-size: 11px;
      padding: 1px 6px;
      border-radius: 999px;
      background: #0c4a6e;
      color: #e0f2fe;
    }
    .bid-title {
      font-weight: 600;
      color: #e5e7eb;
    }
    .bid-meta {
      font-size: 11px;
      color: #9ca3af;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .bid-meta span::before {
      content: "â€¢ ";
    }

    .bid-metrics {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 11px;
      color: #9ca3af;
    }
    .metric-pill {
      padding: 2px 6px;
      border-radius: 999px;
      background: #020617;
      border: 1px dashed #374151;
    }

    /* 1ì°¨ AI ìš”ì•½ ì¹´ë“œ */
    .ai-summary-box {
      background: #020617;
      border-radius: 10px;
      border: 1px solid #1e293b;
      padding: 6px 8px;
      font-size: 12px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .ai-summary-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    .ai-summary-header span.label {
      font-size: 11px;
      color: #9ca3af;
    }
    .ai-summary-header span.relevance {
      font-size: 11px;
      padding: 1px 6px;
      border-radius: 999px;
      border: 1px solid #1f2937;
    }
    .ai-summary-body {
      font-size: 12px;
      color: #e5e7eb;
      line-height: 1.4;
    }
    .ai-summary-body.collapsed {
      display: -webkit-box;
      -webkit-line-clamp: 1;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
      max-height: 1.4em;
    }

    .bid-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      margin-top: 2px;
      gap: 8px;
      flex-wrap: wrap;
    }
    .bid-actions-left {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }
    .bid-actions-right {
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap;
    }

    /* ë¡œë”© / ë¹ˆ ìƒíƒœ */
    .loading, .empty {
      font-size: 13px;
      color: #9ca3af;
      padding: 16px 0;
      text-align: center;
    }

    /* 2ì°¨ ë¶„ì„ ëª¨ë‹¬ */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 30;
    }
    .modal-backdrop.show {
      display: flex;
    }
    .modal {
      background: #020617;
      border-radius: 14px;
      border: 1px solid #1f2937;
      max-width: 720px;
      width: 95%;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .modal-header {
      padding: 10px 14px;
      border-bottom: 1px solid #1f2937;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    .modal-header h2 {
      font-size: 14px;
      margin: 0;
    }
    .modal-body {
      padding: 10px 14px 12px;
      overflow-y: auto;
      font-size: 13px;
    }
    .modal-section {
      margin-bottom: 10px;
    }
    .modal-section h3 {
      margin: 0 0 4px;
      font-size: 12px;
      color: #9ca3af;
    }
    .modal-section p {
      margin: 0;
      line-height: 1.5;
      white-space: pre-line;
    }
    .modal-metrics {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 12px;
    }
    .modal-metrics .chip {
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #374151;
      background: #020617;
    }
    .modal ul {
      margin: 0;
      padding-left: 16px;
      font-size: 12px;
    }
    .modal ul li {
      margin-bottom: 2px;
    }
  </style>
</head>
<body>
  <header>
    <div class="title">
      <span>í•œêµ­ìˆ˜ì•ˆ AI ì…ì°°ê´€ë¦¬</span>
      <span class="badge">AI ì €ë¥˜ì¡° í•„í„° v2</span>
    </div>
    <div>
      <button id="toggle-filter">ìƒë‹¨ ì ‘ê¸°</button>
    </div>
  </header>

  <div id="filter-wrapper" class="filter-wrapper">
    <div class="filter-grid">
      <div class="filter-item">
        <label for="search-title">ê³µê³ ëª… / ë°œì£¼ì²˜ ê²€ìƒ‰</label>
        <input id="search-title" type="text" placeholder="ì˜ˆ: í•™êµ ê°œì¶•, ì €ë¥˜ì¡°, ì„œìš¸ì‹œ" />
      </div>
      <div class="filter-item">
        <label for="filter-region">ì§€ì—­</label>
        <select id="filter-region">
          <option value="">ì „ì²´</option>
          <option value="ì„œìš¸">ì„œìš¸</option>
          <option value="ê²½ê¸°">ê²½ê¸°</option>
          <option value="ì¸ì²œ">ì¸ì²œ</option>
          <option value="ë¶€ì‚°">ë¶€ì‚°</option>
          <option value="ëŒ€ì „">ëŒ€ì „</option>
          <option value="ê´‘ì£¼">ê´‘ì£¼</option>
          <option value="ëŒ€êµ¬">ëŒ€êµ¬</option>
          <option value="ìš¸ì‚°">ìš¸ì‚°</option>
          <option value="ê°•ì›">ê°•ì›</option>
          <option value="ì¶©ì²­">ì¶©ì²­</option>
          <option value="ì „ë¼">ì „ë¼</option>
          <option value="ê²½ìƒ">ê²½ìƒ</option>
          <option value="ì œì£¼">ì œì£¼</option>
          <option value="ì§€ì—­ë¯¸ìƒ">ì§€ì—­ë¯¸ìƒ</option>
        </select>
      </div>
    </div>
  </div>

  <main>
    <div class="toolbar">
      <div class="left">
        <span id="stats-count">ê³µê³  ë¡œë”© ì¤‘...</span>
      </div>
      <div class="right">
        <button class="btn" id="refresh-btn">ìƒˆë¡œê³ ì¹¨</button>
        <button class="btn" id="voice-btn" title="(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ í™•ì¥)">
          ğŸ™ï¸ ìŒì„± ê²€ìƒ‰ (ì¤€ë¹„ì¤‘)
        </button>
      </div>
    </div>

    <div id="list-container">
      <div class="loading">AI í•„í„°ë§ëœ ê³µê³ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
    </div>
  </main>

  <!-- 2ì°¨ ë¶„ì„ ëª¨ë‹¬ -->
  <div id="detail-modal-backdrop" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <h2 id="detail-title">ê³µê³  ìƒì„¸ ë¶„ì„</h2>
        <button class="btn" id="detail-close-btn">ë‹«ê¸°</button>
      </div>
      <div class="modal-body">
        <div class="modal-section">
          <h3>1ì°¨ AI ìš”ì•½</h3>
          <p id="detail-summary1"></p>
        </div>
        <div class="modal-section">
          <h3>2ì°¨ ìƒì„¸ ë¶„ì„ (ê°€ê²©Â·ê·œëª¨Â·í†¤ìˆ˜)</h3>
          <p id="detail-summary2"></p>
        </div>
        <div class="modal-section">
          <h3>ê·œëª¨ ë° ê¸ˆì•¡ ì¶”ì •</h3>
          <div class="modal-metrics">
            <div class="chip" id="chip-siteArea">ëŒ€ì§€ë©´ì : -</div>
            <div class="chip" id="chip-expectedTon">ì˜ˆìƒí†¤ìˆ˜: -</div>
            <div class="chip" id="chip-serviceAmount">ìš©ì—­ê¸ˆì•¡: -</div>
            <div class="chip" id="chip-projectBudget">ì‚¬ì—…ë¹„: -</div>
          </div>
        </div>
        <div class="modal-section">
          <h3>ì²¨ë¶€ë¬¸ì„œ ì´ë¦„ (ë‚˜ë¼ì¥í„° ê¸°ì¤€)</h3>
          <ul id="detail-attachments"></ul>
          <p style="font-size:11px;color:#6b7280;margin-top:4px;">
            * ì²¨ë¶€íŒŒì¼ ë‹¤ìš´ë¡œë“œëŠ” ë‚˜ë¼ì¥í„° ì›ë¬¸ í˜ì´ì§€ì—ì„œ ì§ì ‘ í™•ì¸í•´ ì£¼ì„¸ìš”.
          </p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ==============================
    // í™˜ê²½ ì„¤ì •
    // ==============================
    const API_BASE = 'https://script.google.com/macros/s/AKfycbxi0Bfdty9LuMJyxCGTqTkyJQJrevz3AqRunbhNmePCh68tta-Fu8w1Lw4E_DROWB99zw/exec'; // â† Apps Script WebApp URLë¡œ êµì²´

    let allBids = [];

    // ==============================
    // ì´ˆê¸°í™”
    // ==============================
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('toggle-filter').addEventListener('click', toggleFilter);
      document.getElementById('refresh-btn').addEventListener('click', loadBids);

      document.getElementById('search-title').addEventListener('input', applyFilter);
      document.getElementById('filter-region').addEventListener('change', applyFilter);

      document.getElementById('detail-close-btn').addEventListener('click', closeDetailModal);
      document.getElementById('detail-modal-backdrop').addEventListener('click', (e) => {
        if (e.target.id === 'detail-modal-backdrop') closeDetailModal();
      });

      loadBids();
    });

    // ==============================
    // ìƒë‹¨ í•„í„° ì ‘ê¸°/í¼ì¹˜ê¸°
    // ==============================
    function toggleFilter() {
      const wrapper = document.getElementById('filter-wrapper');
      const btn = document.getElementById('toggle-filter');
      const collapsed = wrapper.classList.toggle('collapsed');
      btn.textContent = collapsed ? 'ìƒë‹¨ í¼ì¹˜ê¸°' : 'ìƒë‹¨ ì ‘ê¸°';
    }

    // ==============================
    // ê³µê³  ëª©ë¡ ë¡œë”©
    // ==============================
    async function loadBids() {
      const container = document.getElementById('list-container');
      container.innerHTML = '<div class="loading">AI í•„í„°ë§ëœ ê³µê³ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>';
      document.getElementById('stats-count').textContent = 'ê³µê³  ë¡œë”© ì¤‘...';

      try {
        const res = await fetch(API_BASE);
        const data = await res.json();
        allBids = Array.isArray(data) ? data : [];
        renderBids(allBids);
      } catch (e) {
        console.error(e);
        container.innerHTML = '<div class="empty">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
        document.getElementById('stats-count').textContent = 'ì˜¤ë¥˜ ë°œìƒ';
      }
    }

    // ==============================
    // í•„í„° ì ìš©
    // ==============================
    function applyFilter() {
      const keyword = document.getElementById('search-title').value.trim();
      const region = document.getElementById('filter-region').value;

      const filtered = allBids.filter(bid => {
        let ok = true;

        if (keyword) {
          const hay = [
            bid.title || '',
            bid.client || '',
            bid.agency || '',
            bid.no || ''
          ].join(' ').toLowerCase();
          if (!hay.includes(keyword.toLowerCase())) {
            ok = false;
          }
        }

        if (ok && region) {
          if (!(bid.region || '').includes(region)) {
            ok = false;
          }
        }

        return ok;
      });

      renderBids(filtered);
    }

    // ==============================
    // ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
    // ==============================
    function renderBids(bids) {
      const container = document.getElementById('list-container');

      if (!bids || bids.length === 0) {
        container.innerHTML = '<div class="empty">ì¡°ê±´ì— ë§ëŠ” ê³µê³ ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        document.getElementById('stats-count').textContent = '0ê±´';
        return;
      }

      document.getElementById('stats-count').textContent =
        `${bids.length.toLocaleString()}ê±´ (í•„í„° í›„)`;

      const frag = document.createDocumentFragment();

      bids.forEach(bid => {
        const card = document.createElement('div');
        card.className = 'bid-card';

        const regionLabel = bid.region || 'ì§€ì—­ë¯¸ìƒ';
        const title = bid.title || 'ì œëª©ì—†ìŒ';
        const no = bid.no || '-';
        const deadline = bid.deadline || bid.date || '';
        const client = bid.client || '';
        const agency = bid.agency || '';
        const status = bid.status || 'ê³µê³ ì¤‘';
        const link = bid.link || '#';
        const aiResult = bid.aiResult || 'AI ë¶„ì„ ê²°ê³¼ ì—†ìŒ';

        const siteArea = bid.siteArea || '';
        const expectedTon = bid.expectedTon || '';
        const serviceAmount = bid.serviceAmount || '';
        const projectBudget = bid.projectBudget || '';

        // ìƒÂ·ì¤‘Â·í•˜ ì¶”ì¶œ
        const relevanceMatch = aiResult.match(/\[(ìƒ|ì¤‘|í•˜)\]/);
        const relevance = relevanceMatch ? relevanceMatch[1] : null;

        // ë©”ì¸
        const mainDiv = document.createElement('div');
        mainDiv.className = 'bid-main';

        const titleLine = document.createElement('div');
        titleLine.className = 'bid-title-line';

        const regionSpan = document.createElement('span');
        regionSpan.className = 'bid-region';
        regionSpan.textContent = regionLabel;

        const titleSpan = document.createElement('span');
        titleSpan.className = 'bid-title';
        titleSpan.textContent = title;

        titleLine.appendChild(regionSpan);
        titleLine.appendChild(titleSpan);

        const metaDiv = document.createElement('div');
        metaDiv.className = 'bid-meta';

        const meta1 = document.createElement('span');
        meta1.textContent = `ê³µê³ ë²ˆí˜¸ ${no}`;
        const meta2 = document.createElement('span');
        meta2.textContent = `ë§ˆê° ${deadline}`;
        if (client) {
          const meta3 = document.createElement('span');
          meta3.textContent = `ë°œì£¼ì²˜ ${client}`;
          metaDiv.appendChild(meta3);
        }
        if (agency) {
          const meta4 = document.createElement('span');
          meta4.textContent = `ìˆ˜ìš”ê¸°ê´€ ${agency}`;
          metaDiv.appendChild(meta4);
        }
        metaDiv.appendChild(meta1);
        metaDiv.appendChild(meta2);

        mainDiv.appendChild(titleLine);
        mainDiv.appendChild(metaDiv);

        // ê·œëª¨/ê¸ˆì•¡ ë¯¸ë‹ˆ ì •ë³´
        const metricsDiv = document.createElement('div');
        metricsDiv.className = 'bid-metrics';

        if (siteArea) {
          const m = document.createElement('span');
          m.className = 'metric-pill';
          m.textContent = `ëŒ€ì§€ë©´ì : ${siteArea}`;
          metricsDiv.appendChild(m);
        }
        if (expectedTon) {
          const m = document.createElement('span');
          m.className = 'metric-pill';
          m.textContent = `ì˜ˆìƒí†¤ìˆ˜: ${expectedTon}`;
          metricsDiv.appendChild(m);
        }
        if (serviceAmount) {
          const m = document.createElement('span');
          m.className = 'metric-pill';
          m.textContent = `ìš©ì—­ê¸ˆì•¡: ${serviceAmount}`;
          metricsDiv.appendChild(m);
        }
        if (projectBudget) {
          const m = document.createElement('span');
          m.className = 'metric-pill';
          m.textContent = `ì‚¬ì—…ë¹„: ${projectBudget}`;
          metricsDiv.appendChild(m);
        }

        // 1ì°¨ ìš”ì•½ ì¹´ë“œ
        const aiBox = document.createElement('div');
        aiBox.className = 'ai-summary-box';

        const aiHeader = document.createElement('div');
        aiHeader.className = 'ai-summary-header';

        const labelSpan = document.createElement('span');
        labelSpan.className = 'label';
        labelSpan.textContent = '1ì°¨ AI ìš”ì•½';

        const relevanceSpan = document.createElement('span');
        relevanceSpan.className = 'relevance';
        if (relevance === 'ìƒ') {
          relevanceSpan.style.borderColor = '#22c55e';
          relevanceSpan.style.color = '#bbf7d0';
        } else if (relevance === 'ì¤‘') {
          relevanceSpan.style.borderColor = '#eab308';
          relevanceSpan.style.color = '#facc15';
        } else if (relevance === 'í•˜') {
          relevanceSpan.style.borderColor = '#4b5563';
          relevanceSpan.style.color = '#9ca3af';
        }
        relevanceSpan.textContent = relevance ? `ê´€ë ¨ì„± ${relevance}` : 'ê´€ë ¨ì„± -';

        const toggleBtn = document.createElement('button');
        toggleBtn.className = 'btn';
        toggleBtn.style.fontSize = '11px';
        toggleBtn.textContent = 'ìì„¸íˆ';

        const bodyDiv = document.createElement('div');
        bodyDiv.className = 'ai-summary-body collapsed';
        bodyDiv.textContent = aiResult.replace(/^\[(ìƒ|ì¤‘|í•˜)\]\s*/, '');

        toggleBtn.addEventListener('click', () => {
          const collapsed = bodyDiv.classList.toggle('collapsed');
          toggleBtn.textContent = collapsed ? 'ìì„¸íˆ' : 'ë‹«ê¸°';
        });

        aiHeader.appendChild(labelSpan);
        aiHeader.appendChild(relevanceSpan);
        aiHeader.appendChild(toggleBtn);

        aiBox.appendChild(aiHeader);
        aiBox.appendChild(bodyDiv);

        // ì•¡ì…˜ ì˜ì—­
        const actions = document.createElement('div');
        actions.className = 'bid-actions';

        const left = document.createElement('div');
        left.className = 'bid-actions-left';

        const statusPill = document.createElement('span');
        statusPill.className = 'status-pill';
        statusPill.textContent = status;

        left.appendChild(statusPill);

        const right = document.createElement('div');
        right.className = 'bid-actions-right';

        const detailBtn = document.createElement('button');
        detailBtn.className = 'btn primary';
        detailBtn.style.fontSize = '11px';
        detailBtn.textContent = '2ì°¨ ë¶„ì„';
        detailBtn.addEventListener('click', () => {
          openDetailAnalysis(no);
        });

        const linkA = document.createElement('a');
        linkA.href = link || '#';
        linkA.target = '_blank';
        linkA.rel = 'noopener noreferrer';
        linkA.className = 'btn';
        linkA.style.fontSize = '11px';
        linkA.textContent = 'ë‚˜ë¼ì¥í„° ì—´ê¸°';

        right.appendChild(detailBtn);
        right.appendChild(linkA);

        actions.appendChild(left);
        actions.appendChild(right);

        card.appendChild(mainDiv);
        if (metricsDiv.childElementCount > 0) {
          card.appendChild(metricsDiv);
        }
        card.appendChild(aiBox);
        card.appendChild(actions);

        frag.appendChild(card);
      });

      container.innerHTML = '';
      container.appendChild(frag);
    }

    // ==============================
    // 2ì°¨ ë¶„ì„ í˜¸ì¶œ
    // ==============================
    async function openDetailAnalysis(no) {
      if (!no) {
        alert('ê³µê³ ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      const backdrop = document.getElementById('detail-modal-backdrop');
      const titleEl = document.getElementById('detail-title');
      const s1El = document.getElementById('detail-summary1');
      const s2El = document.getElementById('detail-summary2');
      const attEl = document.getElementById('detail-attachments');

      // ì´ˆê¸°í™”
      titleEl.textContent = '2ì°¨ ìƒì„¸ ë¶„ì„ ì¤‘...';
      s1El.textContent = '';
      s2El.textContent = 'AIê°€ ìƒì„¸ ë¶„ì„ì„ ìˆ˜í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤...';
      attEl.innerHTML = '';
      setChip('chip-siteArea', 'ëŒ€ì§€ë©´ì : -');
      setChip('chip-expectedTon', 'ì˜ˆìƒí†¤ìˆ˜: -');
      setChip('chip-serviceAmount', 'ìš©ì—­ê¸ˆì•¡: -');
      setChip('chip-projectBudget', 'ì‚¬ì—…ë¹„: -');

      backdrop.classList.add('show');

      try {
        const res = await fetch(`${API_BASE}?action=detailAnalysis&no=${encodeURIComponent(no)}`);
        const data = await res.json();

        if (!data.success) {
          alert(data.message || '2ì°¨ ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          closeDetailModal();
          return;
        }

        titleEl.textContent = `[${data.no}] ${data.title || ''}`;
        s1El.textContent = data.summary1 || '(1ì°¨ ìš”ì•½ ì—†ìŒ)';
        s2El.textContent = data.summary2 || '(2ì°¨ ìƒì„¸ ìš”ì•½ ì—†ìŒ)';

        setChip('chip-siteArea', `ëŒ€ì§€ë©´ì : ${data.siteArea || '-'}`);
        setChip('chip-expectedTon', `ì˜ˆìƒí†¤ìˆ˜: ${data.expectedTon || '-'}`);
        setChip('chip-serviceAmount', `ìš©ì—­ê¸ˆì•¡: ${data.serviceAmount || '-'}`);
        setChip('chip-projectBudget', `ì‚¬ì—…ë¹„: ${data.projectBudget || '-'}`);

        attEl.innerHTML = '';
        if (Array.isArray(data.attachments) && data.attachments.length > 0) {
          data.attachments.forEach(name => {
            const li = document.createElement('li');
            li.textContent = name;
            attEl.appendChild(li);
          });
        } else {
          const li = document.createElement('li');
          li.textContent = 'ì²¨ë¶€íŒŒì¼ ì´ë¦„ ì •ë³´ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.';
          attEl.appendChild(li);
        }
      } catch (e) {
        console.error(e);
        alert('2ì°¨ ë¶„ì„ í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        closeDetailModal();
      }
    }

    function setChip(id, text) {
      const el = document.getElementById(id);
      if (el) el.textContent = text;
    }

    function closeDetailModal() {
      document.getElementById('detail-modal-backdrop').classList.remove('show');
    }
  </script>
</body>
</html>
